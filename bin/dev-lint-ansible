#!/usr/bin/env bash
#
# Lint ansible code
#

#
# Imports
#

# shellcheck source=SCRIPTDIR/dev-set
source ./bin/dev-set || exit 1

# shellcheck source-path=SCRIPTDIR/../lib
source "$DEV_CICD_BASHLIB64" || exit 1

#
# Globals
#

#
# Functions
#

function dev_lint_ansible() {
  local collection=''
  local role=''
  for collection in $DEV_APLATFORM64_COLLECTIONS; do
    cd ${DEV_COLLECTIONS}/${collection}/roles || return $?
    for role in *; do
      bl64_msg_show_phase "lint role (${collection}/${role})"
      "$DEV_CMD_ANSIBLELINT" \
        ansible-lint \
          --project-dir "$role" \
          --config-file "$DEV_ANSIBLE_LINT" || \
        return $?
    done
  done
}

#
# Main
#

declare -i status=0

bl64_msg_show_batch_start 'ansible-lint'
dev_lint_ansible
status=$?
bl64_msg_show_batch_finish $status 'ansible-lint'
exit $status
